{% from 'builtins_pxd/method.pxd.j2' import render_method with context %}
{% from 'builtins_pxd/member.pxd.j2' import render_member with context %}


{% macro render_class(spec, m) %}
@cython.freelist(8)
@cython.final
cdef class {{ spec.name }}:
    cdef {{ spec.c_struct_name }} _gd_data

    @staticmethod
    cdef inline {{ spec.name }} new():
        # Call to __new__ bypasses __init__ constructor
        cdef {{ spec.name }} ret = {{ spec.name }}.__new__({{ spec.name }})
        __{{ spec.name }}_constructor_0(&ret._gd_data, NULL)
        return ret
{% if spec.name == "GDString" %}
    cdef inline gd_string_t to_pystr(self):
        return gdstring_to_pystr(&self._gd_data)
{% endif %}
{% for m in spec.members %}
    {{ render_member(spec, m) | indent }}
{% endfor %}
{% for m in spec.methods %}
    {{ render_method(spec, m) | indent }}
{% endfor %}
{% endmacro %}
